var api;!function(a){function b(b,c,d,e,f){var g=[k];async.eachSeries(g,function(h,i){var j=a.createGetConversationsApiUrl(b,c,h,d,e),k=$.getJSON(j);k.done(function(b){var c=a.parseGetConversationsApiResponse(b);if(null!=c){for(var d=0,e=0;e<c.length;e++)d+=c[e].messages.length;d>=h?g.push(h+l):f(c,null)}else f(null,"Error decoding VoIP.ms API response. Are your username, password, and selected phone number correct?");i(null,null)}),k.fail(function(){f(null,"Error accessing VoIP.ms API. Are you connected to the Internet?"),i(null,null)})},function(){})}function c(a,b,c,d,e){var f=moment().utc().subtract(d,"day"),g=moment().utc();return"https://www.voip.ms/api/v1/rest.php?&api_username="+encodeURIComponent(a)+"&api_password="+encodeURIComponent(b)+"&method=getSMS&did="+encodeURIComponent(e)+"&limit="+encodeURIComponent(String(c))+"&from="+encodeURIComponent(f.toISOString().substr(0,10))+"&to="+encodeURIComponent(g.toISOString().substr(0,10))}function d(a){try{var b=[],c=a.sms;c instanceof Array||(c=[c]);for(var d=c.length-1;d>=0;d--){for(var e=null,f=0;f<b.length;f++)b[f].getRemotePhoneNumber()===c[d].contact&&(e=b[f]);null===e&&(e=new Conversation,b.push(e));var g=new Message(parseInt(c[d].id),c[d].message,moment(c[d].date),0===parseInt(c[d].type)?1:0,c[d].did,c[d].contact);e.messages.push(g)}return b.sort(function(a,b){return a.getEndDate().isSame(b.getEndDate())?0:a.getEndDate().isBefore(b.getEndDate())?1:-1}),b}catch(h){return null}}function e(b,c,d){var e=a.createGetLocalPhoneNumbersApiUrl(b,c),f=$.getJSON(e);f.done(function(b){var c=a.parseGetLocalPhoneNumbersApiResponse(b);null!=c?d(c,null):d(null,"Error decoding VoIP.ms API response. Are your username, password, and selected phone number correct?")}),f.fail(function(){d(null,"Error accessing VoIP.ms API. Are you connected to the Internet?")})}function f(a,b){return"https://www.voip.ms/api/v1/rest.php?&api_username="+encodeURIComponent(a)+"&api_password="+encodeURIComponent(b)+"&method=getDIDsInfo"}function g(a){try{var b=[],c=a.dids;c instanceof Array||(c=[c]);for(var d=0;d<c.length;d++)c[d].sms_available&&b.push(c[d].did);return b}catch(e){return null}}function h(b,c,d,e,f,g){var h=a.createSendMessageApiUrl(b,c,d,e,f),i=$.getJSON(h);i.done(function(b){var c=a.parseSendMessageApiResponse(b);null!=c?g(c,null):g(null,"Error decoding VoIP.ms API response. Are your username, password, and selected phone number correct?")}),i.fail(function(){g(null,"Error accessing VoIP.ms API. Are you connected to the Internet?")})}function i(a,b,c,d,e){return"https://www.voip.ms/api/v1/rest.php?&api_username="+encodeURIComponent(a)+"&api_password="+encodeURIComponent(b)+"&method=sendSMS&did="+encodeURIComponent(c)+"&dst="+encodeURIComponent(d)+"&message="+encodeURIComponent(e)}function j(a){try{var b=a.status;return"success"===b}catch(c){return null}}var k=1e4,l=1e3;a.getConversations=b,a.createGetConversationsApiUrl=c,a.parseGetConversationsApiResponse=d,a.getLocalPhoneNumbers=e,a.createGetLocalPhoneNumbersApiUrl=f,a.parseGetLocalPhoneNumbersApiResponse=g,a.sendSms=h,a.createSendMessageApiUrl=i,a.parseSendMessageApiResponse=j}(api||(api={}));